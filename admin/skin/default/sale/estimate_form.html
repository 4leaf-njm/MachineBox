<style>
	.page {
    width: 21cm;
    min-height: 29.7cm;
    padding: 2cm 1.4cm;
    margin: 0 auto;
}
.subpage {
    padding: 0.5cm;
    height: 256mm;
    border: 1px solid #000;
}
@page {
    size: A4;
    margin: 0;
}
@media print {
    html, body {
        width: 210mm;
        height: 297mm;
    }
    .page {
        margin: 0;
        border: initial;
        border-radius: initial;
        width: initial;
        min-height: initial;
        box-shadow: initial;
        background: initial;
        page-break-after: always;
    }
}
.estimate_wrap {
    font-family: '맑은고딕';
}
.estimate_wrap .form-title {
    text-align: center;
    font-size: 42px;
    font-family: '바탕체';
    border-bottom: 1.5px solid #6b6b6b;
    position: relative;
}
.estimate_wrap .form-title > a {
    position: absolute;
    left: 5px;
    top: 50%;
    font-size: 15px;
    font-weight: bold;
    font-family: '나눔고딕';
    color: #424242;
}
.estimate_wrap .section-title {
    font-weight: bold;
    font-size: 23px;
    margin-top: 20px;
    margin-bottom: 10px;
}
.estimate_wrap .flex-row {
    display: flex;
    justify-content: space-between;
}
.estimate_wrap .tbl-title {
    font-size: 18px;
    font-weight: bold;
    width: 125px;
    text-align: center;
    margin: 5px 0;
}
.estimate_wrap table {
    width: 100%;
    border: 2px solid #000;
    border-collapse: collapse;
}
.estimate_wrap table tr {
    border-top: 1px solid #000;
}
.estimate_wrap table tr:first-child {
    border-top: none;
}
.estimate_wrap table th {
    padding: 3px 10px;
    width: 125px;
    font-size: 18px;
    background: #CEDEEF;
    border-right: 1px solid #000;
    border-left: 1px solid #000;
}
.estimate_wrap table th {
    border-left: 1px solid #000;
    letter-spacing: 1px;
}
.estimate_wrap table td {
    padding: 3px 8px;
}
.estimate_wrap table td input {
    width: 100%;
    height: 30px;
    border: none !important;
    text-align: center;
    font-size: 16px;
    outline: none;
}     
.estimate_wrap .section-01 td {
    width: 190px;
}
.estimate_wrap .section-01 td input {
    text-align: left;
}
.estimate_wrap .section-03 td input {
    font-weight: bold;
    font-family: '나눔고딕';
    font-size: 19px;
}
.estimate_wrap .info-title {
    border-top: 1px solid #000;
    border-bottom: 1px solid #000;
    margin-bottom: 15px;
    padding: 6px 10px 8px;
    font-size: 20px;
    font-weight: bold;
}
.estimate_wrap .section-footer > p {
    font-weight: bold;
    font-size: 19px;
    text-align: center;
}
.estimate_btn {
    text-align: center;
    position: relative;
    bottom: 40px;
}
.btn {
    display: inline-block;
    border: 1px solid #dedede;
    border-radius: 5px;
    font-weight: 400;
    color: #666;
    background: #fff;
    outline: none;
    cursor: pointer;
}
.btn.small {
    padding: 0px 5px 2px;
    font-size: 13px;
}
.btn.medium {
    padding-left: 30px;
    padding-right: 30px;
    height: 32px;
    line-height: 30px;
    font-size: 13px;
}
.btn.large {
    padding-left: 75px;
    padding-right: 75px;
    height: 45px;
    line-height: 43px;
    font-size: 18px;
}
</style>

<body scroll="auto">
	<div class="page">
	    <div class="subpage">
	        <div class="estimate_wrap">
	            <form action="/admin/sale/estimate_form_regist" method="post" id="frm_estimate">
	                <input type="hidden" name="estimate_seq" value="{model_info.estimate_seq}" />
	                <h1 class="form-title">견 적 서<a href="/sch/mch_detail/{model_info.type}/{model_info.info_seq}/est" target="_blank" class="print_hide">기계보기</a></h1>
	                <div class="section-01">
	                    <h2 class="section-title">1. 기업정보</h2>
	                    <div class="flex-row">
	                        <div>
	                            <h3 class="tbl-title">판&nbsp;&nbsp;&nbsp;매&nbsp;&nbsp;&nbsp;자</h3>
	                            <table cellspacing="0">
	                                <tr>
	                                    <th>아&nbsp;&nbsp;&nbsp;이&nbsp;&nbsp;&nbsp;디</th>
	                                    <td><input type="text" name="sale_userid" value="{sale_info.userid}" /></td>
	                                </tr>
	                                <tr>
	                                    <th>소&nbsp;&nbsp;&nbsp;재&nbsp;&nbsp;&nbsp;지</th>
	                                    <td><input type="text" name="sale_baddress" /></td>
	                                </tr>
	                                <tr>
	                                    <th>사업자번호</th>
	                                    <td><input type="text" name="sale_bno"/></td>
	                                </tr>
	                                <tr>
	                                    <th>연&nbsp;&nbsp;&nbsp;락&nbsp;&nbsp;&nbsp;처</th>
	                                    <td><input type="text" name="sale_phone" /></td>
	                                </tr>
	                            </table>
	                        </div>
	                        <div>
	                            <h3 class="tbl-title">구&nbsp;&nbsp;&nbsp;매&nbsp;&nbsp;&nbsp;자</h3>
	                            <table cellspacing="0">
	                                <tr>
	                                    <th>아&nbsp;&nbsp;&nbsp;이&nbsp;&nbsp;&nbsp;디</th>
	                                    <td><input type="text" name="buy_userid" value="{buy_info.userid}" /></td>
	                                </tr>
	                                <tr>
	                                    <th>소&nbsp;&nbsp;&nbsp;재&nbsp;&nbsp;&nbsp;지</th>
	                                    <td><input type="text" name="buy_baddress" /></td>
	                                </tr>
	                                <tr>
	                                    <th>사업자번호</th>
	                                    <td><input type="text" name="buy_bno" /></td>
	                                </tr>
	                                <tr>
	                                    <th>연&nbsp;&nbsp;&nbsp;락&nbsp;&nbsp;&nbsp;처</th>
	                                    <td><input type="text" name="buy_phone" /></td>
	                                </tr>
	                            </table>
	                        </div>
	                    </div>
	                </div>
	                
	                <div class="section-02">
	                    <h2 class="section-title">2. 기본정보</h2>
	                    <h3 class="info-title">(긴급판매) {model_info.model_name} {model_info.mnf_name} 구매 견적서 제출</h3>
	                    <table cellspacing="0">
	                        <tr>
	                            <th>기계분류</th>
	                            <td><input type="text" name="kind_type" value="{model_info.kind_type}" /></td>
	                            <th>기계종류</th>
	                            <td><input type="text" name="kind_name" value="{model_info.kind_name}" /></td>
	                        </tr>
	                        <tr>
	                            <th>제조사</th>
	                            <td><input type="text" name="mnf_name" value="{model_info.mnf_name}" /></td>
	                            <th>모델명</th>
	                            <td><input type="text" name="model_name" value="{model_info.model_name}"  /></td>
	                        </tr>
	                        <tr>
	                            <th>제조년월</th>
	                            <td><input type="text" name="model_year" value="{= str_replace('년', '', model_info.model_year)}년" /></td>
	                            <th>시리얼넘버</th>
	                            <td><input type="text" name="serial_num" value="{model_info.serial_num}" /></td>
	                        </tr>
	                        <tr>
	                            <th>옵&nbsp;&nbsp;션</th>
	                            <td colspan="3"><input type="text" name="option_list" value="{model_info.option_list}" /></td>
	                        </tr>
	                    </table>
	                </div>
	                
	                <div class="section-03">
	                    <h2 class="section-title">3. 견적정보</h2>
	                    <table cellspacing="0">
	                        <tr>
	                            <th>견적일</th>
	                            <td><input type="text" value="{? mode == 'regist'}{= date('Y. m. d')}{:}{= date('Y. m. d', strtotime(estimate_info.reg_date))}{/}" /></td>
	                        </tr>
	                        <tr>
	                            <th>총 계<br/>(부가세포함)</th>
	                            <td><input type="text" value="{? mode == 'regist'}0{/}" id="estimate_total" /></td>
	                        </tr>
	                        <tr>
	                            <th>구매금액</th>
	                            <td><input type="text" name="estimate_price" id="estimate_price"  numberonly="true" placeholder="매입금액을 입력하세요." /></td>
	                        </tr>
	                        <tr>
	                            <th>부가가치세</th>
	                            <td><input type="text" id="estimate_fee" value="{? mode == 'regist'}0{/}" /></td>
	                        </tr>
	                    </table>
	                </div>
	                <div class="section-footer">
	                    <p class="mt-4 mb-3 pt-2 pb-3">머신박스에 정식으로 등록된 상기 기계설비에 대해 위와 같이 견적합니다.</p>
	                    <p>{? mode == 'regist'}{= date('Y 년  m 월  d 일')}{:}{= date('Y 년  m 월  d 일', strtotime(estimate_info.reg_date))}{/}</p>
	                </div>
	            </form>
	        </div>
	    </div>
	</div>
	<div class="estimate_btn print_hide">
	    <!-- {? mode == 'regist'} -->
	    <button type="button" class="btn large" onclick="go_estimate_regist()">작성완료</button>
	    <!-- {: mode == 'view'} -->
	    <button type="button" class="btn large" onclick="go_estimate_print()">출력하기</button>
	    <!-- {/} -->
	</div>
</body>
<!--{? getSessionFlashdata('message') }-->
<script>
    alert('{= getSessionFlashdata('message')}');
</script>
<!--{/}-->
<script type="text/javascript" src="/app/javascript/jquery/jquery.min.js"></script>
<script>
    if('{mode}' == 'regist') {
        if('{is_admin}' == 'y') {
            $('.estimate_wrap input').prop('readonly', false);
        } else {
            $('.estimate_wrap input').prop('readonly', true);
            $('#estimate_price').prop('readonly', false);
        }
    } else if('{mode}' == 'view') {
        $('.estimate_wrap input').prop('readonly', true);
        change_estimate_info('{estimate_info.estimate_price}');
    }
    var sale_baddress = '{sale_info.baddress}';
    var buy_baddress = '{buy_info.baddress}';
    
    var sale_bno = '{sale_info.bno}';
    var buy_bno = '{buy_info.bno}';
    
    var sale_phone = '{sale_info.bcellphone}';
    var buy_phone = '{buy_info.bcellphone}';
    
    sale_baddress = sale_baddress.split(' ');
    var sale_addr_arr = new Array();
    sale_addr_arr[0] = sale_baddress[0];
    sale_addr_arr[1] = sale_baddress[1];
    sale_addr_arr[2] = sale_baddress[2];
    sale_baddress = sale_addr_arr.join(' ');
    
    buy_baddress = buy_baddress.split(' ');
    var buy_addr_arr = new Array();
    buy_addr_arr[0] = buy_baddress[0];
    buy_addr_arr[1] = buy_baddress[1];
    buy_addr_arr[2] = buy_baddress[2];
    buy_baddress = buy_addr_arr.join(' ');
    
    sale_baddress = sale_baddress.lastIndexOf('군') != -1 ? sale_baddress.substring(0, sale_baddress.lastIndexOf('군')+1) : sale_baddress.substring(0, sale_baddress.lastIndexOf('시')+1);
    buy_baddress = buy_baddress.lastIndexOf('군') != -1 ? buy_baddress.substring(0, buy_baddress.lastIndexOf('군')+1) : buy_baddress.substring(0, buy_baddress.lastIndexOf('시')+1);
   
    
    sale_bno = sale_bno.slice(0, -5) + 'xxxxx';
    buy_bno = buy_bno.slice(0, -5) + 'xxxxx';
    
    sale_phone = sale_phone.slice(0, -4) + 'xxxx';
    buy_phone = buy_phone.slice(0, -4) + 'xxxx';
    
    $('input[name=sale_baddress]').val(sale_baddress);
    $('input[name=buy_baddress]').val(buy_baddress);
    
    $('input[name=sale_bno]').val(sale_bno);
    $('input[name=buy_bno]').val(buy_bno);
    
    $('input[name=sale_phone]').val(sale_phone);
    $('input[name=buy_phone]').val(buy_phone);
        
    if('{mode}' == 'regist') {
       $('#estimate_price').focus(function() {
           //var price = $(this).val().replace('\\', '').replaceAll(',', '');
            $(this).val('');
       });
        
       $('#estimate_price').blur(function() {
           var price = parseInt($(this).val() + '0000');
           change_estimate_info(price);
       });
    }

    function change_estimate_info(price) {
        var fee = parseInt(price) * 10 / 100;
        var total = parseInt(price) + fee;
        if(!price || price == 0) {
            price = "";
            fee = "0";
            total = "0";
        } else {
            price = '\\' + comma(price);
            fee = '\\' + comma(fee);
            total = '일금 ' + price_format_kor(String(total)) + ' 정 (KRW '+ comma(total) + ')';
        }
        $('#estimate_price').val(price);
        $('#estimate_fee').val(fee);
        $('#estimate_total').val(total);
    }
    
    function go_estimate_regist() {
        if($('#estimate_price').val() == '') {
            alert('구매금액을 입력해주세요.');
            $('#estimate_price').focus();
            return;
        }
        
        if(confirm('위의 입력한 금액으로 견적서를 제출하시겠습니까 ?')) {
        		$('#estimate_price').val($('#estimate_price').val().replace('\\', '').replace(/,/gi, ''));
            $('#frm_estimate').submit();
        }
    }
    
    function close_estimate_form() {
        self.close();
        self.close();
    }
    
    function go_estimate_print() {
        $('.print_hide').hide();
        window.print();
    }
    
    function comma(num){
        var len, point, str;  
         
        num = num + "";  
        num = num.replace(',', '');
        point = num.length % 3 ;
        len = num.length; 
       
        //<![CDATA[
        str = num.substring(0, point);  
        while (point < len) {  
            if (str != "") str += ",";  
            str += num.substring(point, point + 3);  
            point += 3;  
        }  
        //]]>
        return str;
    }
    function price_format_kor(num) {
        var hanA = new Array("","일","이","삼","사","오","육","칠","팔","구","십");
        var danA = new Array("","십","백","천","","십","백","천","","십","백","천","","십","백","천");
        var result = "";
        for(i=0; i<num.length; i++) {
            str = "";
            han = hanA[num.charAt(num.length-(i+1))];
            if(han != "")
                str += han+danA[i];
                if(i == 4) str += "만"; 
                if(i == 8) str += "억"; 
                if(i == 12) str += "조"; 
                result = str + result;
        }
        if(num != 0)
            result = result + "원"; 
        return result ; 
    } 
</script>